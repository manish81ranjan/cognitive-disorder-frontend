<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Change Password â€¢ DEMNET</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-900 text-white flex items-center justify-center min-h-screen">

<div class="bg-slate-800/70 p-6 rounded-2xl shadow-xl w-full max-w-md">
  <h2 class="text-xl font-bold mb-4">Change Password</h2>

  <form id="changePassForm" class="space-y-4">
    <input type="password" id="old_password" placeholder="Old Password" class="input" required>
    <input type="password" id="new_password" placeholder="New Password" class="input" required>
    <input type="password" id="confirm_password" placeholder="Confirm Password" class="input" required>

    <button type="submit" class="btn">Update Password</button>
  </form>

  <a href="profile.html" class="mt-4 inline-block text-sm text-slate-400 hover:underline">
    Back to Account
  </a>
</div>

<script>
const backend = "https://cognitive-disorder-backend-6.onrender.com";
const user = JSON.parse(localStorage.getItem("user"));

if (!user) {
  window.location.href = "auth.html";
}

document.getElementById("changePassForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const old_password = old_password.value;
  const new_password = new_password.value;
  const confirm_password = confirm_password.value;

  if (new_password !== confirm_password) {
    alert("Passwords do not match");
    return;
  }

  const res = await fetch(`${backend}/api/change-password`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": `Bearer ${user.token}`
    },
    body: JSON.stringify({ old_password, new_password })
  });

  const data = await res.json();
  alert(data.message);

  if (data.status === "success") {
    window.location.href = "profile.html";
  }
});
</script>

</body>
</html>
