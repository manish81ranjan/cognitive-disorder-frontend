<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Hospital Admin Reports</title>

    <!-- FIXED CSS PATH -->
    <link rel="stylesheet" href="admin.css">

    <style>
        body {
            background: #020b14;
            color: #0ff;
            font-family: Segoe UI;
            padding: 30px;
        }

        .title {
            text-align: center;
            font-size: 28px;
            margin-bottom: 20px;
        }

        .glass-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0, 0, 0, .4);
            backdrop-filter: blur(10px);
        }

        .glass-table th,
        .glass-table td {
            padding: 12px;
            border-bottom: 1px solid #0ff;
            text-align: center;
        }

        .btn-glow {
            background: #00ffee;
            color: black;
            padding: 6px 14px;
            border-radius: 8px;
            text-decoration: none;
        }

        .btn-danger {
            background: #ff0040;
            color: white;
            padding: 6px 14px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
        }

        .btn-outline {
            border: 1px solid cyan;
            color: cyan;
            padding: 10px 18px;
            border-radius: 10px;
            text-decoration: none;
            display: inline-block;
            margin-top: 20px;
        }
    </style>
</head>

<body>

<h1 class="title">ðŸ§  Hospital MRI Reports</h1>

<table class="glass-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Patient</th>
            <th>MRI ID</th>
            <th>Diagnosis</th>
            <th>Confidence</th>
            <th>Severity</th>
            <th>Report</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="reportTable">
        <tr><td colspan="8">Loading reports...</td></tr>
    </tbody>
</table>

<a href="admin_dashboard.html" class="btn-outline">â¬… Back</a>

<script>
  const API_BASE = "https://cognitive-disorder-backend-7.onrender.com";

  // ðŸ” Protect route
  if (!localStorage.getItem("adminLoggedIn")) {
    window.location.href = "admin-login.html";
  }

  // ðŸ“¥ Load reports
  fetch(`${API_BASE}/admin-reports-data`, {
    credentials: "include"   // ðŸ”¥ REQUIRED
  })
    .then(res => {
      if (!res.ok) throw new Error("Unauthorized");
      return res.json();
    })
    .then(reports => {
      const table = document.getElementById("reportTable");
      table.innerHTML = "";

      if (!reports.length) {
        table.innerHTML = `<tr><td colspan="8">No reports found</td></tr>`;
        return;
      }

      reports.forEach(r => {
        table.innerHTML += `
          <tr>
            <td>${r.id}</td>
            <td>${r.patient}</td>
            <td>${r.mri_id}</td>
            <td>${r.diagnosis}</td>
            <td>${r.confidence}%</td>
            <td>${r.severity}</td>
            <td>
              <a class="btn-glow"
                 href="${API_BASE}/download-report/${r.id}"
                 target="_blank">
                 View
              </a>
            </td>
            <td>
              <button class="btn-danger" onclick="deleteReport(${r.id})">
                Delete
              </button>
            </td>
          </tr>
        `;
      });
    })
    .catch(err => {
      console.error(err);
      document.getElementById("reportTable").innerHTML =
        `<tr><td colspan="8">Session expired. Please login again.</td></tr>`;
      setTimeout(() => {
        window.location.href = "admin-login.html";
      }, 1500);
    });

  // âŒ Delete report
  function deleteReport(id) {
    if (!confirm("Delete this report?")) return;

    fetch(`${API_BASE}/admin-delete-report/${id}`, {
      method: "DELETE",
      credentials: "include"  // ðŸ”¥ REQUIRED
    })
      .then(res => {
        if (!res.ok) throw new Error("Delete failed");
        return res.json();
      })
      .then(() => location.reload())
      .catch(err => alert("Delete failed"));
  }
</script>


</body>
</html>


